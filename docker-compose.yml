services:
  bot:
    build: .
    image: gridbot:latest
    container_name: gridbot
    restart: unless-stopped
    env_file: /srv/secret-envs/gridbot.env
    command: python grid_trading_bot.py # â¬… ejecuta el trader
    volumes:
      - data:/app # trades.db & csv persisten
    networks:
      - web

  dashboard:
    image: gridbot:latest # reutiliza la MISMA imagen
    depends_on: [bot]
    restart: unless-stopped
    env_file: /srv/secret-envs/gridbot.env
    command: >
      bash -c "streamlit run dashboard.py
               --server.port 8501
               --server.address 0.0.0.0"
    volumes:
      - data:/app # ve los mismos datos
    labels: # Traefik ðŸ”½
      - traefik.enable=true
      #      - traefik.http.routers.gridbot.rule=Host(`gridbot.<TU_DOMINIO>`)
      #      - traefik.http.routers.gridbot.entrypoints=websecure
      #      - traefik.http.routers.gridbot.tls.certresolver=le
      - traefik.http.routers.gridbot.rule=PathPrefix(`/`)
      - traefik.http.routers.gridbot.entrypoints=web
      - traefik.http.services.gridbot.loadbalancer.server.port=8501
    networks:
      - web

volumes:
  data:

networks:
  web:
    external: true # es la misma red que usa Traefik
    name: traefik_default
